# VOD Service ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

VOD Service (Video on Demand) ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∑–∞–ø–∏—Å–µ–π —Å—Ç—Ä–∏–º–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ, –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ò–º–ø–æ—Ä—Ç –∑–∞–ø–∏—Å–µ–π** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å—Ç—Ä–∏–º–æ–≤ –≤ VOD –±–∏–±–ª–∏–æ—Ç–µ–∫—É
2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏** ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π, –æ–ø–∏—Å–∞–Ω–∏–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ç–µ–≥–æ–≤
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏** ‚Äî –ø—É–±–ª–∏—á–Ω—ã–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∏ unlisted –≤–∏–¥–µ–æ
4. **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** ‚Äî full-text search, —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ç–µ–≥–∞–º
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî —Å—á—ë—Ç—á–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ –ª–∞–π–∫–æ–≤
6. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Recording Service   ‚îÇ
‚îÇ       :8083          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îÇ GET /recording/:id
           ‚îÇ (–ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    VOD Service       ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> PostgreSQL (vod_db)
‚îÇ       :8084          ‚îÇ         (—Ç–∞–±–ª–∏—Ü–∞: videos)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îÇ MinIO bucket: recordings
           ‚îÇ (—Å—Å—ã–ª–∫–∏ –Ω–∞ HLS —Ñ–∞–π–ª—ã)
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       MinIO          ‚îÇ
‚îÇ  recordings/         ‚îÇ
‚îÇ  stream_key.mp4      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

***

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Video Handler** ‚Äî HTTP API –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
2. **Video Repository** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
3. **MinIO Storage** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—ä–µ–∫—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
4. **Search Engine** ‚Äî full-text –ø–æ–∏—Å–∫ –ø–æ –≤–∏–¥–µ–æ
5. **Analytics Tracker** ‚Äî —Å—á—ë—Ç—á–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ –ª–∞–π–∫–æ–≤

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```
Video {
  - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: id, user_id, recording_id, stream_id
  - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: title, description, category, tags
  - –ö–æ–Ω—Ç—Ä–æ–ª—å: source, status, visibility
  - –•—Ä–∞–Ω–∏–ª–∏—â–µ: hls_path, thumbnail_path, duration, file_size, resolution
  - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: view_count, like_count
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏: created_at, updated_at, published_at
}
```

***

## API Endpoints

### –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:8084
```

–ß–µ—Ä–µ–∑ API Gateway:
```
http://localhost:8080/api/videos
```

***

## 1. Service Endpoints

### 1.1. Health Check

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.

**Endpoint:** `GET /health`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8084/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "service": "vod-service"
}
```

***

## 2. Public Endpoints

### 2.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö –≤–∏–¥–µ–æ

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

**Endpoint:** `GET /videos`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**Query Parameters:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|--------------|----------|
| `limit` | integer | –ù–µ—Ç | 20 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (max: 100) |
| `offset` | integer | –ù–µ—Ç | 0 | –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ |
| `search` | string | –ù–µ—Ç | - | –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é |
| `category` | string | –ù–µ—Ç | - | –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| `tags` | array | –ù–µ—Ç | - | –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ) |
| `order` | string | –ù–µ—Ç | created_at DESC | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ |

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:**
- `created_at DESC` ‚Äî –Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏
- `created_at ASC` ‚Äî —Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–º–∏
- `view_count DESC` ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–µ—Ä–≤—ã–º–∏
- `published_at DESC` ‚Äî –Ω–µ–¥–∞–≤–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl "http://localhost:8084/videos?limit=10&search=gaming&category=esports"
```

**–ü—Ä–∏–º–µ—Ä —Å —Ç–µ–≥–∞–º–∏:**
```bash
curl "http://localhost:8084/videos?tags=minecraft&tags=survival&limit=5"
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl "http://localhost:8080/api/videos?limit=10&offset=0&order=view_count%20DESC"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "videos": [
    {
      "id": "87d85ca8-6f0b-4037-9ea1-37831bcdbc37",
      "user_id": "a781b655-d4e4-46a0-89da-c4f655bb24f0",
      "recording_id": "e410066c-8d50-4e0f-965f-452af1814ffa",
      "stream_id": "bb52ba50-edc5-4056-a62c-6ef211d72d25",
      "title": "E2E Test Video",
      "description": "Imported from test stream",
      "category": "test",
      "tags": ["e2e", "automated"],
      "source": "recording",
      "status": "ready",
      "visibility": "public",
      "hls_path": "recordings/d1eb2fe800d01c797c84f0b622e474d9.mp4",
      "thumbnail_path": "",
      "duration": 26,
      "file_size": 5672829,
      "resolution": "",
      "view_count": 0,
      "like_count": 0,
      "created_at": "2025-10-05T18:03:19Z",
      "updated_at": "2025-10-05T18:03:19Z",
      "published_at": "2025-10-05T18:03:19Z"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 10
}
```

**–ü–æ–ª—è –≤–∏–¥–µ–æ:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ |
| `user_id` | UUID | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| `recording_id` | UUID \| null | ID –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ recording) |
| `stream_id` | UUID \| null | ID —Å—Ç—Ä–∏–º–∞ (–µ—Å–ª–∏ —Å–≤—è–∑–∞–Ω–æ) |
| `title` | string | –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ |
| `description` | string | –û–ø–∏—Å–∞–Ω–∏–µ |
| `category` | string | –ö–∞—Ç–µ–≥–æ—Ä–∏—è (gaming, education, music, etc.) |
| `tags` | array | –¢–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ |
| `source` | enum | –ò—Å—Ç–æ—á–Ω–∏–∫: `recording`, `upload`, `import` |
| `status` | enum | –°—Ç–∞—Ç—É—Å: `pending`, `ready`, `failed`, `archived` |
| `visibility` | enum | –í–∏–¥–∏–º–æ—Å—Ç—å: `public`, `private`, `unlisted` |
| `hls_path` | string | –ü—É—Ç—å –∫ HLS –≤ MinIO |
| `thumbnail_path` | string | –ü—É—Ç—å –∫ –ø—Ä–µ–≤—å—é |
| `duration` | integer | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö |
| `file_size` | integer | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö |
| `resolution` | string | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ (1920x1080, 1280x720, etc.) |
| `view_count` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ |
| `like_count` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ |
| `created_at` | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | timestamp | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| `published_at` | timestamp \| null | –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ |

***

### 2.2. –ü–æ–ª—É—á–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ ID

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ –∏ URL –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

**Endpoint:** `GET /video/:id`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –≤–∏–¥–µ–æ)

**Path Parameters:**
- `id` (UUID) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8084/video/87d85ca8-6f0b-4037-9ea1-37831bcdbc37
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl http://localhost:8080/api/videos/87d85ca8-6f0b-4037-9ea1-37831bcdbc37
```

**–û—Ç–≤–µ—Ç (–ø—É–±–ª–∏—á–Ω–æ–µ –≤–∏–¥–µ–æ):**
```json
{
  "video": {
    "id": "87d85ca8-6f0b-4037-9ea1-37831bcdbc37",
    "title": "E2E Test Video",
    "description": "Imported from test stream",
    "category": "test",
    "tags": ["e2e", "automated"],
    "status": "ready",
    "visibility": "public",
    "duration": 26,
    "file_size": 5672829,
    "view_count": 0,
    "like_count": 0,
    "created_at": "2025-10-05T18:03:19Z"
  },
  "hls_url": "http://minio:9000/recordings/d1eb2fe800d01c797c84f0b622e474d9.mp4",
  "thumbnail_url": ""
}
```

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):**
```json
{
  "error": "Video is private"
}
```

**HTTP Status:** 403 Forbidden

**–û—Ç–≤–µ—Ç (–≤–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ):**
```json
{
  "error": "Video not found"
}
```

**HTTP Status:** 404 Not Found

***

### 2.3. –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤–∏–¥–µ–æ –Ω–∞ 1.

**Endpoint:** `POST /video/:id/view`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**Path Parameters:**
- `id` (UUID) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8084/video/87d85ca8-6f0b-4037-9ea1-37831bcdbc37/view
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl -X POST http://localhost:8080/api/videos/87d85ca8-6f0b-4037-9ea1-37831bcdbc37/view
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "View count incremented"
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
–≠—Ç–æ—Ç endpoint –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ –≤ –ø–ª–µ–µ—Ä–µ.

***

## 3. Protected Endpoints (—Ç—Ä–µ–±—É—é—Ç JWT)

### 3.1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ VOD

–°–æ–∑–¥–∞—ë—Ç –≤–∏–¥–µ–æ –≤ VOD –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏.

**Endpoint:** `POST /import-recording`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è JWT

**Headers:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "recording_id": "string (UUID)",
  "title": "string (required)",
  "description": "string",
  "category": "string",
  "tags": ["string"],
  "visibility": "public" | "private" | "unlisted"
}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8084/import-recording \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  -H "Content-Type: application/json" \
  -d '{
    "recording_id": "e410066c-8d50-4e0f-965f-452af1814ffa",
    "title": "My Epic Stream Highlights",
    "description": "Best moments from today stream",
    "category": "gaming",
    "tags": ["minecraft", "pvp", "highlights"],
    "visibility": "public"
  }'
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl -X POST http://localhost:8080/api/videos/import-recording \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  -H "Content-Type: application/json" \
  -d '{
    "recording_id": "e410066c-8d50-4e0f-965f-452af1814ffa",
    "title": "My Stream Recording",
    "visibility": "public"
  }'
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "Recording imported successfully",
  "video_id": "87d85ca8-6f0b-4037-9ea1-37831bcdbc37"
}
```

**HTTP Status:** 201 Created

**–û—Ç–≤–µ—Ç (–∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞):**
```json
{
  "error": "Recording not found"
}
```

**HTTP Status:** 404 Not Found

**–ü—Ä–æ—Ü–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞:**
1. VOD Service –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —É Recording Service (`GET /recording/:id`)
2. –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `videos` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `ready`
3. –ö–æ–ø–∏—Ä—É–µ—Ç `file_path` –∏–∑ recording –≤ `hls_path` –≤–∏–¥–µ–æ
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `source = "recording"`
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `video_id` –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

***

### 3.2. –ü–æ–ª—É—á–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤–∏–¥–µ–æ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ).

**Endpoint:** `GET /user/videos`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è JWT

**Headers:**
```
Authorization: Bearer <token>
```

**Query Parameters:**
- `limit` (integer, default: 20) ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `offset` (integer, default: 0) ‚Äî —Å–º–µ—â–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8084/user/videos \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl http://localhost:8080/api/videos/user \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "videos": [
    {
      "id": "87d85ca8-6f0b-4037-9ea1-37831bcdbc37",
      "title": "My Private Video",
      "visibility": "private",
      "status": "ready",
      "view_count": 5,
      "created_at": "2025-10-05T18:00:00Z"
    },
    {
      "id": "abc-123-def",
      "title": "Public Stream Recording",
      "visibility": "public",
      "status": "ready",
      "view_count": 1500,
      "created_at": "2025-10-04T15:00:00Z"
    }
  ],
  "total": 2,
  "page": 1,
  "limit": 20
}
```

***

### 3.3. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ

–û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É.

**Endpoint:** `PUT /video/:id`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è JWT (–≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–µ–æ)

**Path Parameters:**
- `id` (UUID) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ

**Headers:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "title": "string",
  "description": "string",
  "category": "string",
  "tags": ["string"],
  "visibility": "public" | "private" | "unlisted"
}
```

–í—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X PUT http://localhost:8084/video/87d85ca8-6f0b-4037-9ea1-37831bcdbc37 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Updated Title",
    "description": "New description",
    "tags": ["new", "tags"],
    "visibility": "public"
  }'
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl -X PUT http://localhost:8080/api/videos/87d85ca8-6f0b-4037-9ea1-37831bcdbc37 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  -H "Content-Type: application/json" \
  -d '{
    "title": "New Title"
  }'
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "Video updated successfully"
}
```

**–û—Ç–≤–µ—Ç (–Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü):**
```json
{
  "error": "Not authorized"
}
```

**HTTP Status:** 403 Forbidden

---

### 3.4. –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ

–£–¥–∞–ª—è–µ—Ç –≤–∏–¥–µ–æ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É.

**Endpoint:** `DELETE /video/:id`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è JWT (–≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–µ–æ)

**Path Parameters:**
- `id` (UUID) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ

**Headers:**
```
Authorization: Bearer <token>
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X DELETE http://localhost:8084/video/87d85ca8-6f0b-4037-9ea1-37831bcdbc37 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl -X DELETE http://localhost:8080/api/videos/87d85ca8-6f0b-4037-9ea1-37831bcdbc37 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "Video deleted successfully"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `videos`. –§–∞–π–ª—ã –≤ MinIO –æ—Å—Ç–∞—é—Ç—Å—è (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è).

***

### 3.5. –õ–∞–π–∫–Ω—É—Ç—å –≤–∏–¥–µ–æ

–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤ –≤–∏–¥–µ–æ –Ω–∞ 1.

**Endpoint:** `POST /video/:id/like`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è JWT

**Path Parameters:**
- `id` (UUID) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ

**Headers:**
```
Authorization: Bearer <token>
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8084/video/87d85ca8-6f0b-4037-9ea1-37831bcdbc37/like \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–ü—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ API Gateway:**
```bash
curl -X POST http://localhost:8080/api/videos/87d85ca8-6f0b-4037-9ea1-37831bcdbc37/like \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "Video liked"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ª–∞–π–∫–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —ç—Ç–æ –≤–∏–¥–µ–æ. –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å —Ç–∞–±–ª–∏—Ü–µ–π `user_likes`.

***

## 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 4.1. –¢–∞–±–ª–∏—Ü–∞ `videos`

**–°—Ö–µ–º–∞:**
```sql
CREATE TABLE videos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    recording_id UUID REFERENCES recordings(id) ON DELETE SET NULL,
    stream_id UUID,
    
    title VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(100),
    tags TEXT[] DEFAULT '{}',
    
    source video_source DEFAULT 'recording',
    status video_status DEFAULT 'pending',
    visibility video_visibility DEFAULT 'private',
    
    hls_path TEXT NOT NULL,
    thumbnail_path TEXT,
    duration INT DEFAULT 0,
    file_size BIGINT DEFAULT 0,
    resolution VARCHAR(20),
    
    view_count INT DEFAULT 0,
    like_count INT DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    published_at TIMESTAMP,
    
    CONSTRAINT fk_recording FOREIGN KEY (recording_id) 
        REFERENCES recordings(id) ON DELETE SET NULL
);
```

***

### 4.2. ENUM —Ç–∏–ø—ã

```sql
-- –°—Ç–∞—Ç—É—Å –≤–∏–¥–µ–æ
CREATE TYPE video_status AS ENUM (
    'pending',   -- –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
    'ready',     -- –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
    'failed',    -- –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    'archived'   -- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
);

-- –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ
CREATE TYPE video_source AS ENUM (
    'recording', -- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä–∏–º–∞
    'upload',    -- –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
    'import'     -- –ò–º–ø–æ—Ä—Ç –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
);

-- –í–∏–¥–∏–º–æ—Å—Ç—å –≤–∏–¥–µ–æ
CREATE TYPE video_visibility AS ENUM (
    'public',    -- –î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º
    'private',   -- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É
    'unlisted'   -- –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ
);
```

***

### 4.3. –ò–Ω–¥–µ–∫—Å—ã

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_videos_user_id ON videos(user_id);
CREATE INDEX idx_videos_recording_id ON videos(recording_id);
CREATE INDEX idx_videos_stream_id ON videos(stream_id);
CREATE INDEX idx_videos_status ON videos(status);
CREATE INDEX idx_videos_visibility ON videos(visibility);
CREATE INDEX idx_videos_category ON videos(category);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
CREATE INDEX idx_videos_created_at ON videos(created_at DESC);
CREATE INDEX idx_videos_view_count ON videos(view_count DESC);
CREATE INDEX idx_videos_published_at ON videos(published_at DESC);

-- GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –º–∞—Å—Å–∏–≤–∞ —Ç–µ–≥–æ–≤
CREATE INDEX idx_videos_tags ON videos USING GIN(tags);

-- Full-text search –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_videos_search ON videos 
USING GIN(to_tsvector('english', title || ' ' || COALESCE(description, '')));
```

***

## 5. –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### 5.1. Full-text search

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl "http://localhost:8084/videos?search=minecraft+survival"
```

**SQL:**
```sql
SELECT * FROM videos
WHERE to_tsvector('english', title || ' ' || COALESCE(description, '')) 
      @@ plainto_tsquery('english', 'minecraft survival')
  AND visibility = 'public'
  AND status = 'ready'
ORDER BY created_at DESC
LIMIT 20;
```

***

### 5.2. –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl "http://localhost:8084/videos?tags=gaming&tags=fps"
```

**SQL:**
```sql
SELECT * FROM videos
WHERE tags && ARRAY['gaming', 'fps']
  AND visibility = 'public'
  AND status = 'ready'
ORDER BY created_at DESC;
```

***

### 5.3. –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl "http://localhost:8084/videos?category=gaming"
```

**SQL:**
```sql
SELECT * FROM videos
WHERE category = 'gaming'
  AND visibility = 'public'
  AND status = 'ready'
ORDER BY created_at DESC;
```

***

### 5.4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl "http://localhost:8084/videos?search=tutorial&category=education&tags=beginner&order=view_count+DESC&limit=10"
```

**SQL:**
```sql
SELECT * FROM videos
WHERE to_tsvector('english', title || ' ' || COALESCE(description, '')) 
      @@ plainto_tsquery('english', 'tutorial')
  AND category = 'education'
  AND tags && ARRAY['beginner']
  AND visibility = 'public'
  AND status = 'ready'
ORDER BY view_count DESC
LIMIT 10;
```

***

## 6. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 6.1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Service
PORT=8084

# Database
DB_HOST=postgres
DB_PORT=5432
DB_USER=streaming_user
DB_PASSWORD=streaming_pass
DB_NAME=vod_db

# MinIO
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_USE_SSL=false
MINIO_BUCKET=vod-videos

# Services
RECORDING_SERVICE_URL=http://recording-service:8083
JWT_SECRET=your-super-secret-jwt-key-change-in-production
```

***

### 6.2. Docker Compose

```yaml
vod-service:
  build: ./services/vod-service
  container_name: streaming-vod
  environment:
    PORT: ${VOD_SERVICE_PORT}
    DB_HOST: ${DB_HOST}
    DB_PORT: ${DB_PORT}
    DB_USER: ${DB_USER}
    DB_PASSWORD: ${DB_PASSWORD}
    DB_NAME: ${VOD_DB_NAME}
    MINIO_ENDPOINT: ${MINIO_ENDPOINT}
    MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY}
    MINIO_SECRET_KEY: ${MINIO_SECRET_KEY}
    MINIO_USE_SSL: ${MINIO_USE_SSL}
    MINIO_BUCKET: ${MINIO_BUCKET_VOD}
    RECORDING_SERVICE_URL: ${RECORDING_SERVICE_URL}
    JWT_SECRET: ${JWT_SECRET}
  ports:
    - "8084:8084"
  depends_on:
    - postgres
    - minio
  restart: unless-stopped
```

***

## 7. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 7.1. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ó–∞–ø–∏—Å—å ‚Üí VOD

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
RECORDINGS=$(curl -s http://localhost:8083/recordings)
RECORDING_ID=$(echo $RECORDINGS | jq -r '.recordings[0].id')

echo "Recording ID: $RECORDING_ID"

# 2. –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
TOKEN=$(curl -s -X POST http://localhost:8081/login \
  -H "Content-Type: application/json" \
  -d '{"username":"user","password":"password123"}' \
  | jq -r '.token')

echo "Token: ${TOKEN:0:30}..."

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ VOD
VIDEO_ID=$(curl -s -X POST http://localhost:8084/import-recording \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"recording_id\": \"$RECORDING_ID\",
    \"title\": \"My Stream Highlights\",
    \"description\": \"Best moments\",
    \"category\": \"gaming\",
    \"tags\": [\"minecraft\", \"pvp\"],
    \"visibility\": \"public\"
  }" | jq -r '.video_id')

echo "Video ID: $VIDEO_ID"

# 4. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
curl -s http://localhost:8084/video/$VIDEO_ID | jq .

# 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ (—É–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫)
curl -X POST http://localhost:8084/video/$VIDEO_ID/view

# 6. –õ–∞–π–∫–Ω—É—Ç—å –≤–∏–¥–µ–æ
curl -X POST http://localhost:8084/video/$VIDEO_ID/like \
  -H "Authorization: Bearer $TOKEN"
```

***

### 7.2. –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

```bash
# –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
curl "http://localhost:8084/videos?search=minecraft&limit=5"

# –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
curl "http://localhost:8084/videos?category=gaming&limit=10"

# –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∏–¥–µ–æ
curl "http://localhost:8084/videos?order=view_count+DESC&limit=10"

# –ù–æ–≤—ã–µ –≤–∏–¥–µ–æ —Å —Ç–µ–≥–∞–º–∏
curl "http://localhost:8084/videos?tags=tutorial&tags=beginner&order=created_at+DESC"

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫
curl "http://localhost:8084/videos?search=guide&category=education&limit=5"
```

***

### 7.3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ –≤–∏–¥–µ–æ
curl http://localhost:8084/user/videos \
  -H "Authorization: Bearer $TOKEN"

# –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
curl -X PUT http://localhost:8084/video/$VIDEO_ID \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Updated Title",
    "description": "New description",
    "visibility": "public"
  }'

# –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ
curl -X DELETE http://localhost:8084/video/$VIDEO_ID \
  -H "Authorization: Bearer $TOKEN"
```

***

## 8. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### 8.1. –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∏–¥–µ–æ

```sql
SELECT id, title, view_count, like_count, created_at
FROM videos
WHERE visibility = 'public'
  AND status = 'ready'
ORDER BY view_count DESC
LIMIT 10;
```

***

### 8.2. –¢–æ–ø –≤–∏–¥–µ–æ –ø–æ –ª–∞–π–∫–∞–º

```sql
SELECT id, title, like_count, view_count,
       ROUND(like_count::float / NULLIF(view_count, 0) * 100, 2) as like_rate
FROM videos
WHERE visibility = 'public'
  AND status = 'ready'
  AND view_count > 10
ORDER BY like_count DESC
LIMIT 10;
```

***

### 8.3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

```sql
SELECT category,
       COUNT(*) as video_count,
       SUM(view_count) as total_views,
       AVG(duration) as avg_duration
FROM videos
WHERE visibility = 'public'
  AND status = 'ready'
GROUP BY category
ORDER BY total_views DESC;
```

***

## 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 9.1. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker-compose logs -f vod-service
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:**
```
üöÄ Starting VOD Service...
‚úÖ Connected to vod_db successfully
‚úÖ Connected to MinIO bucket: vod-videos
‚úÖ VOD Service running on port 8084
üìπ Recording imported as video: recording_id -> video_id
üëÅÔ∏è View count incremented for video: video_id
‚ù§Ô∏è Video liked: video_id
```

***

### 9.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```bash
curl http://localhost:8084/health
```

***

### 9.3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î

```bash
docker exec streaming-postgres psql -U streaming_user -d vod_db -c "
SELECT 
  COUNT(*) as total_videos,
  COUNT(*) FILTER (WHERE visibility = 'public') as public_videos,
  COUNT(*) FILTER (WHERE status = 'ready') as ready_videos,
  SUM(view_count) as total_views,
  SUM(like_count) as total_likes
FROM videos;"
```

***

## 10. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ù–µ—Ç –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏** ‚Äî –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ recordings
2. **–ù–µ—Ç —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω bitrate –∏–∑ –∑–∞–ø–∏—Å–∏
3. **–ù–µ—Ç thumbnails** ‚Äî –ø—Ä–µ–≤—å—é –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **–õ–∞–π–∫–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏** ‚Äî –º–æ–∂–Ω–æ –ª–∞–π–∫–Ω—É—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
5. **–ù–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ

---

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 1. –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ

```go
POST /video/upload
Content-Type: multipart/form-data

{
  "title": "My Video",
  "video": [binary file],
  "thumbnail": [binary image]
}
```

#### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnails

```go
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
func GenerateThumbnail(videoPath string) (string, error) {
    // FFmpeg: –∏–∑–≤–ª–µ—á—å –∫–∞–¥—Ä –Ω–∞ 10% –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ MinIO
    // –í–µ—Ä–Ω—É—Ç—å URL
}
```

#### 3. Adaptive Bitrate Streaming (ABR)

```
vod-videos/
  videos/{video_id}/
    hls/
      master.m3u8
      720p/playlist.m3u8
      480p/playlist.m3u8
      360p/playlist.m3u8
```

#### 4. –ü–ª–µ–π–ª–∏—Å—Ç—ã

```sql
CREATE TABLE playlists (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE playlist_videos (
    playlist_id UUID REFERENCES playlists(id),
    video_id UUID REFERENCES videos(id),
    position INT NOT NULL,
    PRIMARY KEY (playlist_id, video_id)
);
```

#### 5. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

```sql
CREATE TABLE video_comments (
    id UUID PRIMARY KEY,
    video_id UUID REFERENCES videos(id),
    user_id UUID NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

***

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

VOD Service –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π —Å –ø–æ–∏—Å–∫–æ–º, –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø–∞, –≥–æ—Ç–æ–≤—É—é –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.